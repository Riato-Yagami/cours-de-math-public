% Switch implementation
\newboolean{default}
\newcommand{\case}{}
\newcommand{\default}{}

\newenvironment{switch}[1]{%
    \setboolean{default}{true}
    \renewcommand{\case}[2]{\ifthenelse{\equal{#1}{##1}}{%
        \setboolean{default}{false}##2}{}}%
    \renewcommand{\default}[1]{\ifthenelse{\boolean{default}}{##1}{}}
}{}

% SECTIONS
\input{header/command/sections.tex}

% ANSWERS
\newlength{\parline}
\newlength{\paroutindent}
\newlength{\lineheight}
\setlength{\lineheight}{\heightof{abcdefghijklmnoprstuvwxyz}}

\newcommand{\countlines}[1]{%
    \setlength{\paroutindent}{\expandafter\parindent}
    \setlength{\parline}{\heightof{\noindent\begin{minipage}{\linewidth}%
                \setlength{\parindent}{\paroutindent}#1\end{minipage}}}%
    \pgfmathparse{round(\parline / (0.9*\lineheight))}
    \newcount\linecount
    \pgfmathsetcount{\linecount}{\pgfmathresult}
}

\newcommand{\looptext}[2]{%
    \noindent
    \newcount\printcount
    \printcount=#2
    \loop
        #1
        \advance\printcount by -1
        \ifnum\printcount>0
    \repeat
}

\newcommand{\awsr}[1]{%
    \ifthenelse{\boolean{answer}}{
        \result{#1}
    }{
        \countlines{#1}
        \pgfmathsetcount{\linecount}{\linecount + 1}
        \noindent\hspace{-9pt}
        \looptext{
            \noindent\dotfill
    
        }{\the\linecount}
    }
}

\newcommand{\dottedLines}[1]{%
    \noindent\hspace{-9pt}%

    \looptext{%
        \noindent\dotfill%

    }{#1}
}

\newcommand{\result}[1]{\color{OrangeRed}#1 \color{black}%
}

% MATH
\input{header/command/math.tex}

% IMAGES
\input{header/command/image.tex}

% COMMANDS

\newcommand{\fsize}[1]{\fontsize{#1}{#1}\selectfont}

\NewDocumentCommand{\ifNotNull}{mmo}{
    \IfValueT{#1}{
        \ifx\relax#1\relax
            \IfValueT{#3}{
                #3
            }
        \else
            #2
        \fi
    }
}

\NewDocumentCommand{\ilink}{m g}{%
    \item
    \IfValueTF{#2}{\link{#1}{#2}}{\link{#1}}
}

\NewDocumentCommand{\link}{m g}{%
    \csn{#1}%
    \IfValueT{#2}{(#2)}%
}

\NewDocumentCommand{\TODO}{g}{%
    {\color{Red} $\rightarrow$ \textbf{TODO}
    \IfValueT{#1}{(#1)}}
    % \color{black}
}

\newcommand{\leconInfoBox}[2]{
    \textbf{#1 :}\vspace{-0.25cm}
        \begin{multicols}{2}
            \begin{itemize}[label=$\blacktriangleright$, font = \small \color{Red}]
                #2
            \end{itemize}
        \end{multicols}
        \vspace{-0.4cm}
}

% TCOLORBOX

\input{header/command/tcolorbox.tex}

\NewDocumentCommand{\leconInfo}{mooo}{
    \begin{infoBox}
        \leconInfoBox{Niveaux}{#1}
        \ifNotNull{#2}{
            \tcbline
            \leconInfoBox{Prérequis}{#2}
        }
        \ifNotNull{#3}{
            \tcbline
            \leconInfoBox{Thèmes}{#3}
        }
        \ifNotNull{#4}{
            \tcbline
            \textbf{Motivation :} 
            #4
        }
    \end{infoBox}
}

\NewDocumentCommand{\seanceInfo}{oooooooo}{
    \begin{infoBox}
        \vspace{-0.05cm}
        \begin{tcbitemize}[raster rows=1,raster columns=20,raster height=1.65cm,
            raster every box/.style={colframe=red!50!black,colback=red!10!white}]
            \tcbitem[raster multicolumn=6] \textbf{Date :} #1
            \tcbitem[raster multicolumn=10] \textbf{Séquence :} #2
            \tcbitem[raster multicolumn=4] \textbf{Séance :} #3
        \end{tcbitemize}
        \vspace{-0.25cm}
        \ifNotNull{#4}{\tcbline \textbf{Objectif :} #4}
        \ifNotNull{#5}{\tcbline \leconInfoBox{Classe(s)}{#5}}
        \ifNotNull{#6}{\tcbline \leconInfoBox{Prérequi(s)}{#6}}
        \ifNotNull{#7}{\tcbline \textbf{Séance précédente :} #7}
        \ifNotNull{#7}{\tcbline \leconInfoBox{Matériel(s)}{#8}}
    \end{infoBox}
}

\def\pDscr{\tcbitem[enhanced jigsaw, breakable,
    raster multicolumn=6]
}
\def\pMdlt{\tcbitem[enhanced jigsaw, breakable,
    raster multicolumn=11]
}
\def\pTime{\tcbitem[enhanced jigsaw, breakable,
    raster multicolumn=3, halign=center]
}

\newcommand{\prepRow}[3]{
    \tcbitem[raster multicolumn=20]
    \tcblower

    \pDscr #1
    \pMdlt #2
    \pTime #3
}

\newcommand{\prepTable}[1]{
    \begin{prepBox}
        \begin{tcbitemize}[enhanced jigsaw, breakable, raster rows=1,raster columns=20,raster height=1.1cm, halign=center,
            raster every box/.style={enhanced jigsaw, breakable, colframe=Blue!50!black,colback=Blue!10!white}]
            \pDscr \textbf{Descriptif}
            \pMdlt \textbf{Modalité}
            \pTime \textbf{Durée}
        \end{tcbitemize}
        \begin{tcbitemize}[enhanced jigsaw, breakable,
            raster equal height = rows, 
            raster columns=20, frame hidden,
            raster every box/.style={
                enhanced jigsaw, breakable,
                opacityback=0, valign=top, 
                size = tight
            }]
            #1
        \end{tcbitemize}
    \end{prepBox}
}

% TIKZ

\newcommand{\ctikz}[1]{
    \begin{center}
        \begin{tikzpicture}
            #1
        \end{tikzpicture}
    \end{center}
}

\newcommand{\axis}[1]{%Draw coordinate axes
    \draw[thin, -Stealth] (-0.5,0) -- (#1,0);% node[right] {$x$}; % x-axis
    \draw[thin, -Stealth] (0,-0.5) -- (0,#1);% node[above] {$y$}; % y-axis
}

\newcommand{\drawGrid}[3]{
    \foreach \n in {0,...,#1}
        \draw[line width = #3] (\n,0) -- (\n,#2);
    \foreach \n in {0,...,#2}
        \draw[line width = #3] (0,\n) -- (#1,\n);
}

\newcommand{\drawPoint}[4]{
    \node[shift={#4}, color = \pointColor] at (#2 - 0.5,#3 - 0.5) {#1};
    \draw[line width = \crossWidth, shift={#4}, color = \pointColor] (#2 - 0.25,#3) -- (#2 + 0.25,#3);
    \draw[line width = \crossWidth, shift={#4}, color = \pointColor] (#2,#3 - 0.25) -- (#2,#3 + 0.25);
}

% Tabular
\newcolumntype{C}[1]{>{\centering\arraybackslash}p{#1}}
\newcolumntype{M}[1]{>{\centering\arraybackslash}m{#1}}
\newcolumntype{K}{@{}m{0pt}@{}}

% GEOMETRY

% \newcommand{\restoregeometry}{def}

\newcommand{\multiColItemize}[2]{
    \begin{multicols}{#1}
        \begin{itemize}
            #2
        \end{itemize}
    \end{multicols}
}

\newcommand{\multiColEnumerate}[2]{
    \begin{multicols}{#1}
        \begin{enumerate}
            #2
        \end{enumerate}
    \end{multicols}
}

\makeatletter
\newcommand\pgfinvisible{\pgfsys@begininvisible}
\newcommand\pgfshown{\pgfsys@endinvisible}
\makeatother

\renewcommand*{\phantom}[1]{
    \pgfinvisible #1 \pgfshown
}

\newcounter{size}
\newcommand{\listSize}[1]{%
    \setcounter{size}{0}%
    \foreach \n in {#1}{\stepcounter{size}}%
    % \thesize
}

\newcounter{elemPos}
\newcommand{\listElement}[2]{
    \setcounter{elemPos}{0} % Start counting from 1
    \def\resultVal{0} % Default value
    \renewcommand*{\do}[1]{%
        \ifnumequal{\value{elemPos}}{#2}{%
            \def\resultVal{##1}%
            \listbreak% Break out of the loop
        }{}%
        \stepcounter{elemPos}%
    }
    % \docsvlist{#1}
    \expandafter\docsvlist\expandafter{#1} % Expand the list before passing it to \docsvlist
    \resultVal
}

% \NewDocumentCommand{\exoslide}{m O{10cm}}{
%     \slide{}{
%         \img{\imgf{#1}}[#2]
%     }
% }

\NewDocumentCommand{\exoSlide}{m O{10cm} O{1} O{} O{exo}}{%
    \slide{#5}{%
        \ifthenelse{\equal{#3}{1}}{\vspace{-0.5cm}}{\vspace{-1cm}}
        \def\exercices{\foreach \q in {#1}{\imgp{\q}[#2]\vspace{-0.5cm}}}
        \exo{#1}{\wideFrame[7em]{\bvspace{0.25cm}\avspace{-0.25cm}
            \ifthenelse{\equal{#3}{1}}{\exercices}
            {\begin{multicols}{#3}\exercices\end{multicols}}}
            \avspace{0.75cm}
        }[#4]
    }
}

\NewDocumentCommand{\exoList}{m O{} O{3}}{%
    \section*{Exercices}%
    \slide{EXERCICES}{
        \exo{#2}{
            \vspace{-0.25cm}
            \multiColEnumerate{#3}{
                \foreach \q in {#1}{
                    \item \q
                }
            }
        }
    }
}

\newcommand{\questions}[1]{
    \begin{enumerate}
        \foreach \q in {#1}{
            \item \q\\
            \vspace*{-0.45cm}
            \dottedLines{3}
        }
    \end{enumerate}
}

% Define a new boolean for checking if the section is starred
\newboolean{section@star}

\makeatletter
% Redefine \section and \section* to set the boolean
\let\old@section\section
\renewcommand{\section}{%
    \@ifstar
        {\setboolean{section@star}{true}\old@section*}
        {\setboolean{section@star}{false}\old@section}%
}
\makeatother

\newcommand{\qt}[1]{«\textit{#1}»}

\newcommand{\calc}[1]{\numexpr#1\relax}
\newcommand{\ncalc}[1]{\number\calc{#1}}
\newcommand{\pcalc}[1]{\numprint{\ncalc{#1}}}

\newcommand{\setgrade}[1]{
    \def\grade{#1}
    % \begin{switch}{#1}
    %     \case{6e}{\global\definecolor{gradeColor}{hex}{FA8072}}
    %     \default{
    %         Default
    %         \global\definecolor{gradeColor}{RGB}{200, 50, 50}
    %     }
    % \end{switch}
    \ifthenelse{\equal{#1}{6e}}{
        \definecolor{gradeColor}{HTML}{C6233D} % FA8072 in hex
    }{
    \ifthenelse{\equal{#1}{5e}}{
        \definecolor{gradeColor}{HTML}{088255}
    }{
    \ifthenelse{\equal{#1}{4e}}{
        \definecolor{gradeColor}{HTML}{1466A8}
    }{
    \ifthenelse{\equal{#1}{3e}}{
        \definecolor{gradeColor}{HTML}{844499}
    }{
        \definecolor{gradeColor}{RGB}{0, 0, 0}
    }}}}
}

\gdef\phase{}
\newcommand{\setPhase}[1]{%
    \begin{switch}{#1}
        \case{exo}{\gdef\phase{EXERCICES}}
        \case{cr}{\gdef\phase{COURS}}
        \case{qf}{\gdef\phase{QUESTIONS FLASH}}
        \case{dm}{\gdef\phase{DEVOIR MAISON}}
        \default{\gdef\phase{#1}}
    \end{switch}
}