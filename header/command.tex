% COUNTERS
\newcounter{ex}
\stepcounter{ex}

% SECTIONS

% \newcommand{\pr}[2]{
%     \subsection*{
%         \color{Blue}Propriété\small$_{(\thepr)}$\normalsize : 
%         \color{black}#1
%         }
%     \stepcounter{pr}
%     \begin{mysection}[Blue]
%     #2
%     \end{mysection}
% }

\newenvironment{mysection}[1][gray!20]{%

    \ifthenelse{\boolean{boxedProperties}}{
        \begin{tcolorbox}[colback=white,
            colframe=#1!50,
            boxrule=5pt,
            outer arc=0pt,
            arc=0pt,
            grow to left by= -5pt
    ]
    }{
        \begin{tcolorbox}[colback=white,
            colframe=#1!50,
            boxrule=-1pt,
            arc=0pt,
            leftrule=3pt,
            left = 8pt,
            % boxsep= -3pt,
            % show bounding box
            grow to left by= -5pt
            % fill downwards
        ]
    }
}{%
    \end{tcolorbox}
}

\newenvironment{mysubsection}[1][gray!20]{%
    \begin{tcolorbox}[colback=white,
        colframe=#1!50,
        boxrule=-1pt,
        outer arc=0pt,
        arc=0pt,
        grow to left by= -5pt
    ]
}{%
    \end{tcolorbox}
}

\makeatletter
\newcommand{\createsection}[3]{
    \newcounter{#1}
    \stepcounter{#1}

    \expandafter\newcommand\csname #1\endcsname[2]{

        \label{#1-\csname the#1\endcsname}
        
        \ifx\relax##1\relax
            % \expandafter\newcommand\csname #1-\csname the#1\endcsname\endcsname[1]{%
            %     \hyperlink{#1-\csname the#1\endcsname}{
            %         \textbf{\color{#2}#3 ##1}\color{black}
            %     }
            % }%
        \else
            % IF ##1 is not empty
            \expandafter\newcommand\csname #1-##1\endcsname[1]{%
                \hyperlink{#1-\csname the#1\endcsname}{
                    \textbf{\color{#2!80}#3 ##1}\color{black}
                }
            }%
        \fi

        \def\sectionID{\ifthenelse{\boolean{showID}}
        {\csname the#1\endcsname}{}}

        \def\sectionContent{\ifthenelse{\boolean{outline}}{}{
            \begin{mysection}[#2]
                ##2
            \end{mysection}
        }}
        
        \def\sectionTitle{
            \color{#2}\hypertarget{#1-\csname the#1\endcsname}
            {#3}\ifthenelse{\boolean{parenthisedID}}
            {\small$_{(\sectionID)}$}
            { \sectionID}\normalsize : 
            \color{black}##1
        }
        
        \@ifclassloaded{beamer}{
            \textbf{\sectionTitle}
        }{
            \subsection*{\sectionTitle}
        }
        \sectionContent

        \stepcounter{#1}
    }
}
\makeatother

\newcommand{\refsec}[2]{%
    \expandafter\csname #1-#2\endcsname{#2}%
}

% \newcommand{\refsec}[2]{%
%     \expandafter\csname #1#2\endcsname%
% }

\createsection{pr}{\PropertyColor}{Propriété}
\createsection{df}{\DefinitionColor}{Définition}
\createsection{thm}{\TheoremColor}{Théorème}

\newcommand{\ex}[2]{
    \subsubsection*{
        \color{Thistle}Exercice \theex 
        % \small$_{(\theex)}$\normalsize 
        :
        \color{black}#1
        }
    \stepcounter{ex}
    #2
}

\makeatletter
\newcommand{\createsubsection}[3]{
    \newcounter{#1}
    \stepcounter{#1}

    \expandafter\newcommand\csname #1\endcsname[2]{

        \label{#1-\csname the#1\endcsname}
        
        \ifx\relax##1\relax
        \else
            % IF ##1 is not empty
            \expandafter\newcommand\csname #1-##1\endcsname[1]{%
                \hyperlink{#1-\csname the#1\endcsname}{
                    \textbf{\color{#2!80}#3 ##1}\color{black}
                }
            }%
        \fi

        % \def\sectionID{\ifthenelse{\boolean{showID}}
        % {\csname the#1\endcsname}{}}

        \def\sectionContent{\ifthenelse{\boolean{outline}}{}{##2}}
        
        \def\sectionTitle{
            \color{#2}\hypertarget{#1-\csname the#1\endcsname}
            {#3} \normalsize : 
            \color{black}##1
        }

        \@ifclassloaded{beamer}{
            \begin{mysubsection}[#2]
            \textbf{\sectionTitle \ifx\relax##1\relax\else \\ \fi}
            \sectionContent
            \end{mysubsection}
        }{
            \subsubsection*{\sectionTitle}
            \sectionContent
        }

        \stepcounter{#1}
    }
}
\makeatother

\makeatletter
\newcommand{\createsubsubsection}[3]{
    \newcounter{#1}
    \stepcounter{#1}

    \expandafter\newcommand\csname #1\endcsname[2]{

        \label{#1-\csname the#1\endcsname}
        
        \ifx\relax##1\relax
        \else
            % IF ##1 is not empty
            \expandafter\newcommand\csname #1-##1\endcsname[1]{%
                \hyperlink{#1-\csname the#1\endcsname}{
                    \textbf{\color{#2!80}#3 ##1}\color{black}
                }
            }%
        \fi

        % \def\sectionID{\ifthenelse{\boolean{showID}}
        % {\csname the#1\endcsname}{}}

        \def\sectionContent{\ifthenelse{\boolean{outline}}{}{\color{black}##2}}
        
        \def\sectionTitle{
            \color{#2}\hypertarget{#1-\csname the#1\endcsname}
            {#3} \normalsize : 
            \color{black}##1
        }

        \ifthenelse{\boolean{subsectionInOutline}}{}{
            \@ifclassloaded{beamer}{
                \begin{mysubsection}[#2]
                \textbf{\sectionTitle \ifx\relax##1\relax\else \\ \fi}
                \sectionContent
                \end{mysubsection}
            }{
                \subsubsection*{\sectionTitle}
                \sectionContent
            }
        }
        \stepcounter{#1}
    }
}
\makeatother

\createsubsection{cor}{NavyBlue}{Corollaire}
\createsubsection{lem}{NavyBlue}{Lemme}
\createsubsection{ctr}{NavyBlue}{Contraposée}
\createsubsection{rmdr}{Thistle}{Rappel}
\createsubsection{mthd}{OrangeRed}{Méthode}
% \createsubsection{hintSUB}{black}{\it{Indication}}

\createsubsubsection{rmk}{Thistle}{Remarque}
\createsubsubsection{expl}{gray}{Exemple}
\createsubsubsection{app}{RedViolet}{Application}

\createsubsubsection{demoSUB}{Red}{$\rightarrow$ Démonstration}
\createsubsubsection{ticeSUB}{Orchid}{TICE}

\newcommand{\hint}[2]{
    \textit{Indication: #2}
}

\newcommand{\demo}[2]{
    \ifthenelse{\boolean{demonstration}}{
        \demoSUB{#1}{
            \ifNotNull{#2}{
                #2 $\square$
            }
        }
    }{
    }
}

\newcommand{\tice}[3]{
    \ticeSUB{#1 - #2}{#3}
}

\newlength{\parline}
\newlength{\paroutindent}
\newlength{\lineheight}
\setlength{\lineheight}{\heightof{abcdefghijklmnoprstuvwxyz}}

\newcommand{\countlines}[1]{%
    \setlength{\paroutindent}{\expandafter\parindent}
    \setlength{\parline}{\heightof{\noindent\begin{minipage}{\linewidth}%
                \setlength{\parindent}{\paroutindent}#1\end{minipage}}}%
    \pgfmathparse{round(\parline / (0.9*\lineheight))}
    \newcount\linecount
    \pgfmathsetcount{\linecount}{\pgfmathresult}
}

\newcommand{\looptext}[2]{%
    \noindent
    \newcount\printcount
    \printcount=#2
    \loop
        #1
        \advance\printcount by -1
        \ifnum\printcount>0
    \repeat
}

\newcommand{\awsr}[1]{%
    \ifthenelse{\boolean{anwser}}{
        \color{OrangeRed}#1\color{black}
    }{
        \countlines{#1}
        \noindent\hspace{-9pt}
        \looptext{
            \noindent\dotfill
    
        }{\the\linecount}
    }
}

% MATH

\newcommand{\modxy}[2]{\sqrt{#1^2+#2^2}}
\newcommand{\acroissement}[2]{\frac{#1(#2+h)-#1(#2)}{h}}

\newcommand{\pow}[2]{
    #1
    \foreach \n in {2,...,#2}{
        \times #1
    }
}
\newcommand{\lPowBrace}[2]{
    \underbrace{\pow{#1}{2} \times ... \times \pow{#1}{2}}_{#2 \textrm{ fois}}
}
\newcommand{\powBrace}[2]{
    \underbrace{#1 \times ... \times #1}_{#2 \textrm{ fois}}
}

\newcommand{\lfbrace}[1]{
    \left\{
        \begin{array}{ll}
            #1
        \end{array}
    \right.
}

\newcommand{\dl}[1]{
    o(x^{#1})
}

\newcommand{\pgcd}[2]{
    % \PGCD(#1,#2)
    #1 \wedge #2
}

\newcommand{\ppcm}[2]{
    % \PPCM(#1,#2)
    #1 \vee #2
}

% COMMANDS

\newcommand{\fsize}[1]{\fontsize{#1}{#1}\selectfont}

\NewDocumentCommand{\ifNotNull}{mmo}{
    \IfValueT{#1}{
        \ifx\relax#1\relax
            \IfValueT{#3}{
                #3
            }
        \else
            #2
        \fi
    }
}

\NewDocumentCommand{\img}{m O{\linewidth} o}{%
    \begin{figure}[H]%
        \centering%
        \includegraphics[width=#2]{#1}%
        \IfValueTF{#3}{
            \caption{\underline{#3}}
            % \vspace{-0.4cm}
            }{
            % \vspace{-0.4cm}
        }
        \vspace{-0.45cm}
    \end{figure}%
}

\NewDocumentCommand{\ilink}{m g}{%
    \item
    \IfValueTF{#2}{\link{#1}{#2}}{\link{#1}}
}

\NewDocumentCommand{\link}{m g}{%
    \csn{#1}%
    \IfValueT{#2}{(#2)}%
}

\NewDocumentCommand{\TODO}{g}{%
    \color{Red} $\rightarrow$ \textbf{TODO}
    \IfValueT{#1}{(#1)}%
}

\newcommand{\infoLeconBox}[2]{
    \textbf{#1 :}\vspace{-0.25cm}
        \begin{multicols}{2}
            \begin{itemize}[label=$\blacktriangleright$, font = \small \color{Red}]
                #2
            \end{itemize}
        \end{multicols}
        \vspace{-0.4cm}
}

\NewDocumentCommand{\infoLecon}{mooo}{
    \begin{tcolorbox}[colback=red!5!white,
        colframe=red!75!black]
        \infoLeconBox{Niveaux}{#1}
        \ifNotNull{#2}{
            \tcbline
            \infoLeconBox{Prérequis}{#2}
        }
        \ifNotNull{#3}{
            \tcbline
            \infoLeconBox{Thèmes}{#3}
        }
        \ifNotNull{#4}{
            \tcbline
            \textbf{Motivation :} 
            #4
        }
    \end{tcolorbox}
}

% TIKZ
\newcommand{\drawGrid}[3]{
    \foreach \n in {0,...,#1}
        \draw[line width = #3] (\n,0) -- (\n,#2);
    \foreach \n in {0,...,#2}
        \draw[line width = #3] (0,\n) -- (#1,\n);
}

\newcommand{\drawPoint}[4]{
    \node[shift={#4}, color = \pointColor] at (#2 - 0.5,#3 - 0.5) {#1};
    \draw[line width = \crossWidth, shift={#4}, color = \pointColor] (#2 - 0.25,#3) -- (#2 + 0.25,#3);
    \draw[line width = \crossWidth, shift={#4}, color = \pointColor] (#2,#3 - 0.25) -- (#2,#3 + 0.25);
}